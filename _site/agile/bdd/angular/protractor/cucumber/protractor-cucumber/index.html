<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Functional testing with cucumber and protractor &#8211; Things that make my head hurt</title>
<meta name="description" content="Now I love Behaviour Driven Development I love it for many reasons but my main reason is the way it completes my development process.  TDD allows me to test how my code works to validate that the new function has been implemented correctly, to put me in the mindset of writing minimalist and well structured code, to give me confidence I am not breaking any existing code.  It is not so great at describing what behaviour the system is supposed to exhibit and if you work with an Agile methodology it is a pretty terrible interface between the developer and the product owner.

">
<meta name="keywords" content="">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Functional testing with cucumber and protractor">
<meta name="twitter:description" content="Now I love Behaviour Driven Development I love it for many reasons but my main reason is the way it completes my development process.  TDD allows me to test how my code works to validate that the new function has been implemented correctly, to put me in the mindset of writing minimalist and well structured code, to give me confidence I am not breaking any existing code.  It is not so great at describing what behaviour the system is supposed to exhibit and if you work with an Agile methodology it is a pretty terrible interface between the developer and the product owner.

">



<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://0.0.0.0:4000/images/">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Functional testing with cucumber and protractor">
<meta property="og:description" content="Now I love Behaviour Driven Development I love it for many reasons but my main reason is the way it completes my development process.  TDD allows me to test how my code works to validate that the new function has been implemented correctly, to put me in the mindset of writing minimalist and well structured code, to give me confidence I am not breaking any existing code.  It is not so great at describing what behaviour the system is supposed to exhibit and if you work with an Agile methodology it is a pretty terrible interface between the developer and the product owner.

">
<meta property="og:url" content="http://0.0.0.0:4000/agile/bdd/angular/protractor/cucumber/protractor-cucumber/">
<meta property="og:site_name" content="Things that make my head hurt">





<link rel="canonical" href="http://0.0.0.0:4000/agile/bdd/angular/protractor/cucumber/protractor-cucumber/">
<link href="http://0.0.0.0:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Things that make my head hurt Feed">
<link rel="author" href="http://plus.google.com/+NicJackson?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://0.0.0.0:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://0.0.0.0:4000/assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://0.0.0.0:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://0.0.0.0:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://0.0.0.0:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://0.0.0.0:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://0.0.0.0:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://0.0.0.0:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://0.0.0.0:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://0.0.0.0:4000/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="http://0.0.0.0:4000">Things that make my head hurt</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
					    
					        
					    
					    <li><a href="http://0.0.0.0:4000/about/" >About</a></li>
					  
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    



	<img src="http://0.0.0.0:4000/images/bio-photo.jpg" class="bio-photo" alt="Nic Jackson bio photo"></a>

<h3>Nic Jackson</h3>
<p>Geek, Ultrarunner and part time software engineering manager for Marks and Spencer.</p>



<a href="http://plus.google.com/+NicJackson" class="author-social" target="_blank"><i class="fa fa-google-plus-square"></i> Google+</a>
<a href="http://linkedin.com/in/jacksonnic" class="author-social" target="_blank"><i class="fa fa-linkedin-square"></i> LinkedIn</a>


<a href="http://github.com/nicholasjackson" class="author-social" target="_blank"><i class="fa fa-github"></i> Github</a>






  </div>
  <article>
    <div class="headline-wrap">
      
        <h1><a href="http://0.0.0.0:4000/agile/bdd/angular/protractor/cucumber/protractor-cucumber/" rel="bookmark" title="Functional testing with cucumber and protractor">Functional testing with cucumber and protractor</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p>Now I love Behaviour Driven Development I love it for many reasons but my main reason is the way it completes my development process.  TDD allows me to test how my code works to validate that the new function has been implemented correctly, to put me in the mindset of writing minimalist and well structured code, to give me confidence I am not breaking any existing code.  It is not so great at describing what behaviour the system is supposed to exhibit and if you work with an Agile methodology it is a pretty terrible interface between the developer and the product owner.</p>

<h3 id="what-is-bdd">What is BDD?</h3>
<p>BDD was developed by Dan North to create some shared tools that both developers and customers could use.  In an Agile world the product owner can sit with the developers and write the features that describe the behaviour that they would like the system to exhibit.  Working in this way it helps the developer get clarity on the problem and it also helps define a group of statements that can later be used as acceptance criteria.</p>

<h3 id="gherkin">Gherkin</h3>
<p>The most common implementation is to use the Gherkin language, Gherkin is a domain specific language which uses simple grammer to describe behaviour without having to detail how it is implemented.  Below is a simple example that might define some of the functinality for a login page:</p>

<div class="highlight"><pre><code class="language-gherkin" data-lang="gherkin"><span class="k">Feature:</span><span class="nf"> Login Page</span>
<span class="nf">  As a user of the site</span>
<span class="nf">  I should be able to login</span>

<span class="nf">  </span><span class="k">Scenario:</span><span class="nf"> Login Page Title</span>
<span class="k">    Given </span><span class="nf">I go on &quot;</span><span class="s">login.html</span><span class="nf">&quot;</span>
<span class="nf">    </span><span class="k">Then </span><span class="nf">the title should equal &quot;</span><span class="s">Login</span><span class="nf">&quot;</span>

<span class="nf">  </span><span class="k">Scenario:</span><span class="nf"> Login With In-Correct Details</span>
<span class="k">    Given </span><span class="nf">I go on &quot;</span><span class="s">login.html</span><span class="nf">&quot;</span>
<span class="nf">    </span><span class="k">When </span><span class="nf">I enter incorrect user credentials</span>
<span class="nf">    </span><span class="k">Then </span><span class="nf">I should see the message &quot;</span><span class="s">Either your username or password are incorrect!</span><span class="nf">&quot;</span></code></pre></div>

<p>There is no complex code going on there, the feature file reads in simple plain English and the developer has sat with the product owner and has written this so there is no area for misinterpretation.  These on their own are pretty useful as it is a nice uniform way to define acceptance criteria.  The real beauty of Gherkin however is when you use it with an automated test suite, this allows the developer to write code using an outside in methodology (shown in the below image), repeatedly and predictably testing the implementation.</p>

<h3 id="outside-in-development">Outside in development</h3>
<p><img src="http://0.0.0.0:4000/images/post_images/outside-in-development.png" alt="XCode Build Phases" /></p>

<p>The developer starts with the failing feature and then working scenario by scenario incrementally goes about getting the steps to pass.  In order to get the steps to pass they will most likely have to write some failing unit tests and thus some code to satisfy those unit tests.  Once all scenarios in the feature are passing then the acceptance criteria for the story has been met and the story can be considered done.  The bottom line on this process is quality code, but you don’t care about quality right because you love to repeat yourself 1000s of times going over the same bug.</p>

<h3 id="automated-test-runners">Automated test runners</h3>
<p>There are a million and one different test runners that implement Gherkin (Cucumber, RSpec, the original JBehave) and therefore it can be used to test everything from raw code, APIs, Websites and Mobile Applications.  Personally I use this approach for all of the afore-mentioned applications and we have even written a specific test runner to test Starling framework mobile applications.  One of the more common test runners you will find used is Cucumber and other than to bore you about my love for BDD I want to show how Cucumber can be used to test your AngularJS based web applications.</p>

<h3 id="enter-angularjs">Enter AngularJS</h3>
<p>AngularJS is a Javascript framework for the modern web, it allows you to build dynamic views using a unified and tested framework, data bind to Restful services using an MVVM model and a whole host of other things which I am not even going to pretend I understand.  One of the great features about Angular is that it has been written from a testability perspective, live services can be easily replaced with test data and it supports dependency injection out of the box so it really helps with writing clean well structured bug free code.</p>

<h3 id="angularjs-testing-with-protractor">AngularJS testing with Protractor</h3>
<p>So that has our unit testing covered but how are we going to test our behaviour, I guess we will just use cucumber and selenium webdriver.  Well you could but It will cause you pain as Angular is an asynchronous framework, just because the page has loaded does not mean that angular has completed the layout.  This means you are going to have to handle the load completion yourself.  Except you are not, the kind people responsible for Angular have thought about this and created the protractor framework.  Protractor understands Angular directives and its async behaviour so you don’t have to write any extra code.  It gives you the ability to access your repeaters directly so no more messy CSS or DOM selectors.</p>

<p>If you want to check how many items you have on a page it becomes as simple as the below example:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;angularjs homepage todo list&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should add a todo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">browser</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://www.angularjs.org&#39;</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">todoList</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">by</span><span class="p">.</span><span class="nx">repeater</span><span class="p">(</span><span class="s1">&#39;todo in todos&#39;</span><span class="p">));</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">todoList</span><span class="p">.</span><span class="nx">count</span><span class="p">()).</span><span class="nx">toEqual</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">todoList</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="nx">getText</span><span class="p">()).</span><span class="nx">toEqual</span><span class="p">(</span><span class="s1">&#39;write a protractor test&#39;</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></div>

<h3 id="protractor-with-cucumber">Protractor with Cucumber</h3>
<p>Previously you would write your tests using the Jasmine framework, whilst this was fine for developers its not the greatest business interface.  Worry not, out of the box Protractor now supports Cucumber, this means you can write your Gherkin files and Cucumber deals with the interface of these to your javascript specs.  This gives you the ability to easily create a framework for testing your application using regular expressions to maximise re-use whilst retaining the connection to the business.</p>

<p>Consider the below feature file:</p>

<div class="highlight"><pre><code class="language-gherkin" data-lang="gherkin"><span class="k">Feature:</span><span class="nf"> Running Cucumber with Protractor</span>
<span class="nf">  As a user of Protractor</span>
<span class="nf">  I should be able to use Cucumber</span>
<span class="nf">  to run my E2E tests</span>

<span class="nf">  </span><span class="k">Scenario:</span><span class="nf"> Wrapping WebDriver</span>
<span class="k">    Given </span><span class="nf">I go on &quot;</span><span class="s">index.html</span><span class="nf">&quot;</span>
<span class="nf">    </span><span class="k">Then </span><span class="nf">the title should equal &quot;</span><span class="s">My AngularJS App</span><span class="nf">&quot;</span></code></pre></div>

<p>This translates directly into the javascript implementation file listed below:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">//http://chaijs.com/</span>
<span class="kd">var</span> <span class="nx">chai</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;chai&#39;</span><span class="p">);</span>

<span class="c1">//https://github.com/domenic/chai-as-promised/</span>
<span class="kd">var</span> <span class="nx">chaiAsPromised</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;chai-as-promised&#39;</span><span class="p">);</span>
<span class="nx">chai</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">chaiAsPromised</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">expect</span> <span class="o">=</span> <span class="nx">chai</span><span class="p">.</span><span class="nx">expect</span><span class="p">;</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">Given</span><span class="p">(</span><span class="sr">/^I go on &quot;([^&quot;]*)&quot;$/</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
    <span class="nx">browser</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;http://localhost:9001&#39;</span><span class="p">);</span>
    <span class="nx">callback</span><span class="p">()</span>
  <span class="p">});</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">Then</span><span class="p">(</span><span class="sr">/^the title should equal &quot;([^&quot;]*)&quot;$/</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Write code here that turns the phrase above into concrete actions</span>
    <span class="nx">expect</span><span class="p">(</span><span class="nx">browser</span><span class="p">.</span><span class="nx">getTitle</span><span class="p">()).</span><span class="nx">to</span><span class="p">.</span><span class="nx">eventually</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">arg1</span><span class="p">).</span><span class="nx">and</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span></code></pre></div>

<p>As you can see where I have used words like “index.html” in my feature file this has been replaced with a regular expression in my Javascript.  This means I can re-use this step file anywhere I need to write “Given I go on ‘page.html’”, pretty flexible and pretty awesome.  Ok these steps are not so useful for the business but they are not meant to be this is for you, the feature file is your contract to the business.</p>

<h3 id="give-it-a-go-i-dare-you">Give it a go I dare you</h3>
<p>Protractor and Cucumber are not without their faults but this is a million steps forward from where we were a year ago.  If you are a developer writing web apps with the Angular framework then you are most likely already using Protractor.  If you are not using Cucumber give it a go and see how it improves your relationship with your customer.  If you are the customer and you are not already using BDD, give it ago, I guarantee you will see positive results with your software quality and a better relationship with your developers.</p>

<p>For your convenience I have created a simple example which uses a scaffold Angular app, you can get it right here, right now :)</p>

<h3 id="source-code">Source Code:</h3>
<p><a href="https://github.com/nicholasjackson/protractor-cucumber-example">https://github.com/nicholasjackson/protractor-cucumber-example</a></p>

      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          



	<img src="http://0.0.0.0:4000/images/bio-photo.jpg" class="bio-photo" alt="Nic Jackson bio photo"></a>

<h3>Nic Jackson</h3>
<p>Geek, Ultrarunner and part time software engineering manager for Marks and Spencer.</p>



<a href="http://plus.google.com/+NicJackson" class="author-social" target="_blank"><i class="fa fa-google-plus-square"></i> Google+</a>
<a href="http://linkedin.com/in/jacksonnic" class="author-social" target="_blank"><i class="fa fa-linkedin-square"></i> LinkedIn</a>


<a href="http://github.com/nicholasjackson" class="author-social" target="_blank"><i class="fa fa-github"></i> Github</a>






        </div>
        <p class="byline"><strong>Functional testing with cucumber and protractor</strong> was published on <time datetime="2014-09-09T01:00:00+01:00">September 09, 2014</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="http://0.0.0.0:4000/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="http://0.0.0.0:4000/agile/ee/why-ee-is-very-wrong/" title="Why EE's new customer service policy could not be more wrong">Why EE's new customer service policy could not be more wrong</a></li>
    
      <li><a href="http://0.0.0.0:4000/swift/ios/swift-unit-tests-and-access-modifiers/" title="Swift Unit Tests and Access Modifiers">Swift Unit Tests and Access Modifiers</a></li>
    
      <li><a href="http://0.0.0.0:4000/azure/python/python-packages-and-azure-webjobs/" title="Python Packages and Azure WebJobs">Python Packages and Azure WebJobs</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    <div class="google-ads">
  <!-- 320 x 50 ad -->
  <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <ins class="adsbygoogle"
       style="display:inline-block;width:320px;height:50px"
       data-ad-client=""
       data-ad-slot=""></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div><!-- /.google-ads -->

<span>&copy; 2014 Nic Jackson. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://0.0.0.0:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://0.0.0.0:4000/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-53659420-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'thingsthatmakemyheadhurt'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	        

</body>
</html>